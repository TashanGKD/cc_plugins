# Pre-commit é…ç½®
# å®‰è£…: pip install pre-commit && pre-commit install

default_language_version:
  python: python3

repos:
  # æäº¤ä¿¡æ¯è§„èŒƒæ£€æŸ¥
  - repo: https://github.com/compilerla/conventional-pre-commit
    rev: v3.2.0
    hooks:
      - id: conventional-pre-commit
        stages: [commit-msg]
        types: [text]
        # æ”¯æŒçš„ç±»å‹å’Œç®€å•æ ¼å¼
        args: [
          feat, fix, docs, style, refactor, test, chore  # å…è®¸çš„ type
        ]

  # æœ¬åœ° hooks
  - repo: local
    hooks:
      # éªŒè¯æ’ä»¶é…ç½®ï¼ˆä»…åœ¨ marketplace.json å˜æ›´æ—¶ï¼‰
      - id: validate-plugin
        name: Validate Plugin Config
        entry: bash -c '
          echo "ğŸ” éªŒè¯æ’ä»¶é…ç½®..."

          # æ£€æŸ¥ Claude CLI
          if ! command -v claude &> /dev/null; then
            echo "âŒ Claude CLI æœªå®‰è£…"
            exit 1
          fi

          # è¿è¡ŒéªŒè¯
          if ! claude plugin validate .claude-plugin/marketplace.json; then
            echo "âŒ marketplace.json éªŒè¯å¤±è´¥"
            exit 1
          fi

          echo "âœ… é…ç½®éªŒè¯é€šè¿‡"
        '
        language: system
        files: '\.claude-plugin/marketplace\.json'
        pass_filenames: false

  # é€šç”¨æ£€æŸ¥
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # æ£€æŸ¥ JSON æ ¼å¼
      - id: check-json
        files: '(\.claude-plugin/.*\.json|plugins/.*/\.mcp\.json)'
      # æ£€æŸ¥ YAML æ ¼å¼
      - id: check-yaml
      # æ£€æŸ¥å¤§æ–‡ä»¶
      - id: check-added-large-files
        args: ['--maxkb=100']
      # æ£€æŸ¥è¡Œå°¾ç©ºç™½
      - id: trailing-whitespace
      # æ£€æŸ¥ç»“å°¾æ¢è¡Œ
      - id: end-of-file-fixer
